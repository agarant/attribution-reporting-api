(()=>{"use strict";var e={143:function(e,t,r){var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,i,n)}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Token=void 0,n(r(802),t),n(r(788),t),n(r(816),t),n(r(689),t);var s=r(472);Object.defineProperty(t,"Token",{enumerable:!0,get:function(){return s.Token}})},788:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParseError=t.parseItem=t.parseList=t.parseDictionary=void 0;const i=r(816),n=r(472),s=r(689);t.parseDictionary=function(e){return new a(e).parseDictionary()},t.parseList=function(e){return new a(e).parseList()},t.parseItem=function(e){return new a(e).parseItem()};class o extends Error{constructor(e,t){super(`Parse error: ${t} at offset ${e}`)}}t.ParseError=o;class a{constructor(e){this.input=e,this.pos=0}parseDictionary(){this.skipWS();const e=new Map;for(;!this.eof();){const t=this.parseKey();let r;if("="===this.lookChar()?(this.pos++,r=this.parseItemOrInnerList()):r=[!0,this.parseParameters()],e.set(t,r),this.skipOWS(),this.eof())return e;if(this.expectChar(","),this.pos++,this.skipOWS(),this.eof())throw new o(this.pos,"Dictionary contained a trailing comma")}return e}parseList(){this.skipWS();const e=[];for(;!this.eof();){if(e.push(this.parseItemOrInnerList()),this.skipOWS(),this.eof())return e;if(this.expectChar(","),this.pos++,this.skipOWS(),this.eof())throw new o(this.pos,"A list may not end with a trailing comma")}return e}parseItem(e=!0){e&&this.skipWS();const t=[this.parseBareItem(),this.parseParameters()];return e&&this.checkTrail(),t}parseItemOrInnerList(){return"("===this.lookChar()?this.parseInnerList():this.parseItem(!1)}parseInnerList(){this.expectChar("("),this.pos++;const e=[];for(;!this.eof();){if(this.skipWS(),")"===this.lookChar())return this.pos++,[e,this.parseParameters()];e.push(this.parseItem(!1));const t=this.lookChar();if(" "!==t&&")"!==t)throw new o(this.pos,"Expected a whitespace or ) after every item in an inner list")}throw new o(this.pos,"Could not find end of inner list")}parseBareItem(){const e=this.lookChar();if(void 0===e)throw new o(this.pos,"Unexpected end of string");if(e.match(/^[-0-9]/))return this.parseIntegerOrDecimal();if('"'===e)return this.parseString();if(e.match(/^[A-Za-z*]/))return this.parseToken();if(":"===e)return this.parseByteSequence();if("?"===e)return this.parseBoolean();throw new o(this.pos,"Unexpected input")}parseParameters(){const e=new Map;for(;!this.eof()&&";"===this.lookChar();){this.pos++,this.skipWS();const t=this.parseKey();let r=!0;"="===this.lookChar()&&(this.pos++,r=this.parseBareItem()),e.set(t,r)}return e}parseIntegerOrDecimal(){let e="integer",t=1,r="";if("-"===this.lookChar()&&(t=-1,this.pos++),!u(this.lookChar()))throw new o(this.pos,"Expected a digit (0-9)");for(;!this.eof();){const t=this.getChar();if(u(t))r+=t;else{if("integer"!==e||"."!==t){this.pos--;break}if(r.length>12)throw new o(this.pos,"Exceeded maximum decimal length");r+=".",e="decimal"}if("integer"===e&&r.length>15)throw new o(this.pos,"Exceeded maximum integer length");if("decimal"===e&&r.length>16)throw new o(this.pos,"Exceeded maximum decimal length")}if("integer"===e)return parseInt(r,10)*t;if(r.endsWith("."))throw new o(this.pos,"Decimal cannot end on a period");if(r.split(".")[1].length>3)throw new o(this.pos,"Number of digits after the decimal point cannot exceed 3");return parseFloat(r)*t}parseString(){let e="";for(this.expectChar('"'),this.pos++;!this.eof();){const t=this.getChar();if("\\"===t){if(this.eof())throw new o(this.pos,"Unexpected end of input");const t=this.getChar();if("\\"!==t&&'"'!==t)throw new o(this.pos,"A backslash must be followed by another backslash or double quote");e+=t}else{if('"'===t)return e;if(!(0,s.isAscii)(t))throw new o(this.pos,"Strings must be in the ASCII range");e+=t}}throw new o(this.pos,"Unexpected end of input")}parseToken(){let e="";for(;!this.eof();){const t=this.lookChar();if(void 0===t||!/^[:/!#$%&'*+\-.^_`|~A-Za-z0-9]$/.test(t))return new n.Token(e);e+=this.getChar()}return new n.Token(e)}parseByteSequence(){this.expectChar(":"),this.pos++;const e=this.input.indexOf(":",this.pos);if(-1===e)throw new o(this.pos,'Could not find a closing ":" character to mark end of Byte Sequence');const t=this.input.substring(this.pos,e);if(this.pos+=t.length+1,!/^[A-Za-z0-9+/=]*$/.test(t))throw new o(this.pos,"ByteSequence does not contain a valid base64 string");return new i.ByteSequence(t)}parseBoolean(){this.expectChar("?"),this.pos++;const e=this.getChar();if("1"===e)return!0;if("0"===e)return!1;throw new o(this.pos,'Unexpected character. Expected a "1" or a "0"')}parseKey(){var e;if(!(null===(e=this.lookChar())||void 0===e?void 0:e.match(/^[a-z*]/)))throw new o(this.pos,"A key must begin with an asterisk or letter (a-z)");let t="";for(;!this.eof();){const e=this.lookChar();if(void 0===e||!/^[a-z0-9_\-.*]$/.test(e))return t;t+=this.getChar()}return t}lookChar(){return this.input[this.pos]}expectChar(e){if(this.lookChar()!==e)throw new o(this.pos,`Expected ${e}`)}getChar(){return this.input[this.pos++]}eof(){return this.pos>=this.input.length}skipOWS(){for(;;){const e=this.input.substr(this.pos,1);if(" "!==e&&"\t"!==e)break;this.pos++}}skipWS(){for(;" "===this.lookChar();)this.pos++}checkTrail(){if(this.skipWS(),!this.eof())throw new o(this.pos,"Unexpected characters at end of input")}}t.default=a;const c=/^[0-9]$/;function u(e){return void 0!==e&&c.test(e)}},802:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serializeKey=t.serializeParameters=t.serializeToken=t.serializeByteSequence=t.serializeBoolean=t.serializeString=t.serializeDecimal=t.serializeInteger=t.serializeBareItem=t.serializeInnerList=t.serializeItem=t.serializeDictionary=t.serializeList=t.SerializeError=void 0;const i=r(816),n=r(472),s=r(689);class o extends Error{}function a(e){return u(e[0])+m(e[1])}function c(e){return`(${e[0].map((e=>a(e))).join(" ")})${m(e[1])}`}function u(e){if("number"==typeof e)return Number.isInteger(e)?h(e):l(e);if("string"==typeof e)return p(e);if(e instanceof n.Token)return g(e);if(e instanceof i.ByteSequence)return d(e);if("boolean"==typeof e)return f(e);throw new o("Cannot serialize values of type "+typeof e)}function h(e){if(e<-999999999999999||e>999999999999999)throw new o("Structured headers can only encode integers in the range range of -999,999,999,999,999 to 999,999,999,999,999 inclusive");return e.toString()}function l(e){const t=e.toFixed(3).replace(/0+$/,"");if(t.split(".")[0].replace("-","").length>12)throw new o("Fractional numbers are not allowed to have more than 12 significant digits before the decimal point");return t}function p(e){if(!(0,s.isAscii)(e))throw new o("Only ASCII strings may be serialized");return`"${e.replace(/("|\\)/g,(e=>"\\"+e))}"`}function f(e){return e?"?1":"?0"}function d(e){return`:${e.toBase64()}:`}function g(e){return e.toString()}function m(e){return Array.from(e).map((([e,t])=>{let r=";"+w(e);return!0!==t&&(r+="="+u(t)),r})).join("")}function w(e){if(!(0,s.isValidKeyStr)(e))throw new o("Keys in dictionaries must only contain lowercase letter, numbers, _-*. and must start with a letter or *");return e}t.SerializeError=o,t.serializeList=function(e){return e.map((e=>(0,s.isInnerList)(e)?c(e):a(e))).join(", ")},t.serializeDictionary=function(e){return Array.from(e.entries()).map((([e,t])=>{let r=w(e);return!0===t[0]?r+=m(t[1]):(r+="=",(0,s.isInnerList)(t)?r+=c(t):r+=a(t)),r})).join(", ")},t.serializeItem=a,t.serializeInnerList=c,t.serializeBareItem=u,t.serializeInteger=h,t.serializeDecimal=l,t.serializeString=p,t.serializeBoolean=f,t.serializeByteSequence=d,t.serializeToken=g,t.serializeParameters=m,t.serializeKey=w},472:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Token=void 0;const i=r(689);t.Token=class{constructor(e){if(!(0,i.isValidTokenStr)(e))throw new TypeError("Invalid character in Token string. Tokens must start with *, A-Z and the rest of the string may only contain a-z, A-Z, 0-9, :/!#$%&'*+-.^_`|~");this.value=e}toString(){return this.value}}},816:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ByteSequence=void 0,t.ByteSequence=class{constructor(e){this.base64Value=e}toBase64(){return this.base64Value}}},689:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isByteSequence=t.isInnerList=t.isValidKeyStr=t.isValidTokenStr=t.isAscii=void 0;const r=/^[\x20-\x7E]*$/,i=/^[a-zA-Z*][:/!#$%&'*+\-.^_`|~A-Za-z0-9]*$/,n=/^[a-z*][*\-_.a-z0-9]*$/;t.isAscii=function(e){return r.test(e)},t.isValidTokenStr=function(e){return i.test(e)},t.isValidKeyStr=function(e){return n.test(e)},t.isInnerList=function(e){return Array.isArray(e[0])},t.isByteSequence=function(e){return"object"==typeof e&&"base64Value"in e}},864:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateEligible=void 0;const{parseDictionary:i}=r(143);t.validateEligible=function(e){const t={errors:[],warnings:[]};let r;try{r=i(e)}catch(e){const r=e instanceof Error?e.toString():"unknown error";return t.errors.push({msg:r}),t}for(const[e,i]of r){switch(e){case"event-source":case"trigger":break;case"navigation-source":t.warnings.push({msg:"may only be specified in browser-initiated requests",path:[e]});break;default:t.warnings.push({msg:"unknown dictionary key",path:[e]})}!0!==i[0]&&t.warnings.push({msg:"ignoring dictionary value",path:[e]}),0!==i[1].size&&t.warnings.push({msg:"ignoring parameters",path:[e]})}return t}},736:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateJSON=t.validateTrigger=t.validateSource=void 0;const r=/^[0-9]+$/,i=/^-?[0-9]+$/,n=/^0[xX][0-9A-Fa-f]{1,32}$/,s=20,o=20,a=50,c=50;class u{constructor(){this.path=[],this.errors=[],this.warnings=[]}error(e){this.errors.push({path:[...this.path],msg:e})}warn(e){this.warnings.push({path:[...this.path],msg:e})}scope(e,t){this.path.push(e),t(),this.path.pop()}result(){return{errors:this.errors,warnings:this.warnings}}validate(e,t){g(((e,r)=>{Object.entries(t).forEach((([e,t])=>this.scope(e,(()=>t(this,r,e))))),Object.keys(r).forEach((e=>{e in t||this.scope(e,(()=>this.warn("unknown field")))}))}))(this,e)}}function h(e){return(t,r,i)=>{i in r?e(t,r[i]):t.error("missing required field")}}function l(e){return(t,r,i)=>{i in r&&e(t,r[i])}}function p(e=((e,t)=>{})){return(t,r)=>{"string"!=typeof r?t.error("must be a string"):e(t,r)}}function f(e,t){"boolean"!=typeof t&&e.error("must be a boolean")}function d(e){return null!==e&&"object"==typeof e&&e.constructor===Object}function g(e){return(t,r)=>{d(r)?e(t,r):t.error("must be an object")}}function m(e,t=1/0){return g(((r,i)=>{const n=Object.entries(i);n.length>t&&r.error(`exceeds the maximum number of keys (${t})`),n.forEach((([t,i])=>r.scope(t,(()=>e(r,t,i)))))}))}function w(e,t=1/0,r=0){return(i,n)=>{if(Array.isArray(n))return(n.length>t||n.length<r)&&i.error(`List size out of expected bounds. Size must be within [${r}, ${t}]`),void n.forEach(((t,r)=>i.scope(r,(()=>e(i,t)))));i.error("must be a list")}}const y=p(((e,t)=>{r.test(t)?BigInt(t)>2n**64n-1n&&e.error("must fit in an unsigned 64-bit integer"):e.error(`must be a uint64 (must match ${r})`)}));function b(e){return(t,r)=>{"number"!=typeof r?t.error("must be a number"):e(t,r)}}const v=b(((e,t)=>{(!Number.isInteger(t)||t<0)&&e.error("must be a non-negative integer")})),k=b(((e,t)=>{(!Number.isInteger(t)||t<=0)&&e.error("must be a positive integer")})),_=p(((e,t)=>{if(!i.test(t))return void e.error(`must be an int64 (must match ${i})`);const r=BigInt(t);(r<(-2n)**(64n-1n)||r>2n**(64n-1n)-1n)&&e.error("must fit in a signed 64-bit integer")})),S=p(((e,t)=>{if(!n.test(t))return e.error(`must be a hex128 (must match ${n})`)})),x=p(((e,t)=>{let r;try{r=new URL(t)}catch{return void e.error("must contain a valid URL")}"https:"!==r.protocol&&("http:"!==r.protocol||"localhost"!==r.hostname&&"127.0.0.1"!==r.hostname)&&e.error("must contain a potentially trustworthy URL"),"/"!==r.pathname&&e.warn("contains a path that will be ignored"),""!==r.search&&e.warn("contains a query string that will be ignored"),""!==r.hash&&e.warn("contains a fragment that will be ignored")})),I=w(x,3,1);function z(e,t){return"string"==typeof t?x(e,t):Array.isArray(t)?I(e,t):void e.error("must be a list or a string")}function C(e,t){"number"==typeof t?(!Number.isInteger(t)||t<0||t>o)&&e.error("must be an integer in the range [0, 20]"):e.error("must be an integer in the range [0, 20]")}function O(e,t){e.validate(t,{start_time:l(v),end_times:h(w(k,5,1))})}function $(e,t){return"number"==typeof t?v(e,t):"string"==typeof t?y(e,t):void e.error("must be a non-negative integer or a string")}const E=()=>m(((e,t,r)=>{w(p())(e,r)})),j=function(e,t=1/0,r=0){return(i,n)=>d(n)?e(i,n):Array.isArray(n)?w(e,t,r)(i,n):void i.error("must be a list or an object")}(E()),A=m(((e,t,r)=>{S(e,r)}),s);t.validateSource=function(e){const t=new u;return t.validate(e,{aggregatable_report_window:l($),event_report_window:l($),event_report_windows:l(O),aggregation_keys:l(A),debug_key:l(y),debug_reporting:l(f),destination:h(z),expiry:l($),filter_data:l(m(((e,t,r)=>{"source_type"!==t?w(p(),c)(e,r):e.error("is prohibited because it is implicitly set")}),a)),priority:l(_),source_event_id:l(y),max_event_level_reports:l(C)}),d(e)&&"event_report_window"in e&&"event_report_windows"in e&&t.error("event_report_window and event_report_windows in the same source"),t.result()};const L=w(((e,t)=>e.validate(t,{filters:l(j),key_piece:h(S),not_filters:l(j),source_keys:l(w(p(),s))}))),q=m(((e,t,r)=>{("number"!=typeof r||!Number.isInteger(r)||r<=0||r>65536)&&e.error("must be an integer in the range (1, 65536]")}),s),B=w(((e,t)=>e.validate(t,{deduplication_key:l(y),filters:l(j),not_filters:l(j),priority:l(_),trigger_data:l(y)}))),P=w(((e,t)=>e.validate(t,{deduplication_key:l(y),filters:l(E()),not_filters:l(E())}))),T=p(((e,t)=>{const r="exclude",i="include";t!==r&&t!==i&&e.error(`must match '${r}' or '${i}' (case-sensitive)`)}));t.validateTrigger=function(e){const t=new u;return t.validate(e,{aggregatable_trigger_data:l(L),aggregatable_values:l(q),aggregation_coordinator_origin:l(x),debug_key:l(y),debug_reporting:l(f),event_trigger_data:l(B),filters:l(j),not_filters:l(j),aggregatable_deduplication_keys:l(P),aggregatable_source_registration_time:l(T)}),t.result()},t.validateJSON=function(e,t){let r;try{r=JSON.parse(e)}catch(e){return{errors:[{msg:e instanceof Error?e.toString():"unknown error"}],warnings:[]}}return t(r)}},666:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateOsRegistration=void 0;const{parseList:i}=r(143);function n(e){if("string"!=typeof e)return"must be a string";let t;try{t=new URL(e)}catch{return"must contain a valid URL"}return"https:"!==t.protocol&&("http:"!==t.protocol||"localhost"!==t.hostname&&"127.0.0.1"!==t.hostname)?"must contain a potentially trustworthy URL":void 0}t.validateOsRegistration=function(e){const t={errors:[],warnings:[]};let r;try{r=i(e)}catch(e){const r=e instanceof Error?e.toString():"unknown error";return t.errors.push({msg:r}),t}for(let e=0;e<r.length;e++){const[i,s]=r[e],o=n(i);if(o)t.errors.push({msg:o,path:[e]});else for(const[r,i]of s)"debug-reporting"===r?"boolean"!=typeof i&&t.errors.push({msg:"must be a boolean",path:[e,r]}):t.warnings.push({msg:"unknown parameter",path:[e,r]})}return t}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i].call(s.exports,s,s.exports,r),s.exports}(()=>{const e=r(736),t=r(864),i=r(666),n=document.querySelector("form"),s=n.querySelector("textarea"),o=document.querySelector("#errors"),a=document.querySelector("#warnings"),c=document.querySelector("#success"),u=document.querySelector("#pathful-issue");function h(e){return"string"==typeof e?`["${e}"]`:`[${e}]`}function l({path:e,msg:t}){let r;return Array.isArray(e)?0===e.length?(r=document.createElement("li"),r.textContent=t):(r=u.content.cloneNode(!0),r.querySelector("code").textContent=e.map(h).join(""),r.querySelector("span").textContent=t):(r=document.createElement("li"),r.textContent=t),r}function p(){return n.elements.namedItem("header").value}n.addEventListener("input",(()=>{let r;switch(p()){case"source":r=(0,e.validateJSON)(s.value,e.validateSource);break;case"trigger":r=(0,e.validateJSON)(s.value,e.validateTrigger);break;case"os-source":case"os-trigger":r=(0,i.validateOsRegistration)(s.value);break;case"eligible":r=(0,t.validateEligible)(s.value);break;default:return}const n=document.createElement("div");0===r.errors.length&&0===r.warnings.length?n.textContent="The header is valid.":n.textContent="",c.replaceChildren(n),o.replaceChildren(...r.errors.map(l)),a.replaceChildren(...r.warnings.map(l))})),document.querySelector("#linkify").addEventListener("click",(async()=>{const e=new URL(location.toString());e.search="",e.searchParams.set("header",p()),e.searchParams.set("json",s.value),await navigator.clipboard.writeText(e.toString())}));const f=new URLSearchParams(location.search),d=f.get("json");d&&(s.value=d);const g=new Set(["eligible","os-source","os-trigger","source","trigger"]);let m=f.get("header");null!==m&&g.has(m)||(m="source"),n.querySelector(`input[value=${m}]`).click()})()})();